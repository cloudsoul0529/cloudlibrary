<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.seventhgroup.dao.StatsMapper">

    <!-- 统计图书总数 -->
    <select id="selectBookCount" resultType="int">
        SELECT COUNT(*) FROM book
    </select>

    <!-- 统计用户总数 -->
    <select id="selectUserCount" resultType="int">
        SELECT COUNT(*) FROM user
    </select>

    <!-- 统计借阅记录总数 -->
    <select id="selectRecordCount" resultType="int">
        SELECT COUNT(*) FROM record
    </select>

    <!-- 联合查询详细借阅数据 -->
    <select id="selectReportData" resultType="java.util.Map">
        SELECT
            record_bookname as bName,
            record_bookisbn as isbn,
            record_borrower as uName,
            record_borrowtime as bTime,
            record_remandtime as rTime
        FROM record
    </select>

    <!-- 统计热门图书 -->
    <select id="selectTop5Books" resultType="java.util.Map">
        SELECT
        record_bookname as name,
        COUNT(*) as value
        FROM record
        GROUP BY record_bookname
        ORDER BY value DESC
        LIMIT 5
    </select>

    <!-- 统计每日借阅趋势 -->
    <select id="selectDailyTrend" resultType="java.util.Map">
        SELECT
            LEFT(record_borrowtime, 10) as name,
            COUNT(*) as value
        FROM record
        WHERE record_borrowtime IS NOT NULL AND record_borrowtime != ''
        GROUP BY name
        ORDER BY name
    </select>
</mapper>